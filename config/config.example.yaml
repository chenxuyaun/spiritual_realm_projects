# =============================================================================
# MuAI多模型编排系统 - 示例配置文件
# MuAI Multi-Model Orchestration System - Example Configuration
# =============================================================================
#
# 使用说明 / Usage:
#   1. 复制此文件为 system.yaml: cp config.example.yaml config/system.yaml
#   2. 根据您的环境修改配置项
#   3. 系统启动时会自动加载 config/system.yaml
#
# 配置优先级 / Configuration Priority:
#   环境变量 > 配置文件 > 默认值
#
# =============================================================================

# -----------------------------------------------------------------------------
# 系统基础配置 / System Base Configuration
# -----------------------------------------------------------------------------
system:
  # 日志级别 / Logging Level
  # 可选值: DEBUG, INFO, WARNING, ERROR, CRITICAL
  # DEBUG: 详细调试信息，包含所有日志
  # INFO: 一般运行信息（推荐生产环境）
  # WARNING: 警告信息
  # ERROR: 错误信息
  # CRITICAL: 严重错误
  log_level: INFO
  
  # 最大缓存模型数量 / Maximum Cached Models
  # 系统使用LRU策略管理模型缓存，超过此数量时会卸载最久未使用的模型
  # 建议值: GPU内存16GB设置为2-3，32GB设置为3-4
  max_cached_models: 3
  
  # 发展阶段 / Development Stage
  # 控制系统的功能解锁级别
  # 可选值: infant（婴儿期）, child（儿童期）, adolescent（青少年期）, adult（成人期）
  # infant: 基础对话功能
  # child: 解锁搜索问答
  # adolescent: 解锁教学生成和RAG
  # adult: 全部功能解锁
  development_stage: adult
  
  # 推理设备 / Inference Device
  # 可选值: auto, cuda, cpu
  # auto: 自动检测，优先使用GPU
  # cuda: 强制使用GPU（需要NVIDIA显卡）
  # cpu: 强制使用CPU（速度较慢但兼容性好）
  device: auto

# -----------------------------------------------------------------------------
# 模型配置 / Model Configuration
# -----------------------------------------------------------------------------
models:
  # Qwen Chat模型 - 主要对话和生成模型
  qwen_chat:
    # 模型路径，可以是HuggingFace模型ID或本地路径
    model_path: "Qwen/Qwen-7B-Chat"
    # 推理设备: auto, cuda, cpu
    device: auto
    # 量化选项: null（不量化）, 8bit, 4bit
    # 量化可以减少显存占用，但可能影响生成质量
    quantization: null
    # 最大生成长度（tokens）
    max_length: 2048
    # 生成温度，越高越随机，越低越确定
    # 范围: 0.0-2.0，推荐: 0.5-1.0
    temperature: 0.7
  
  # GPT2模型 - 备用生成模型
  gpt2:
    model_path: "gpt2"
    device: auto
    quantization: null
    max_length: 1024
    temperature: 0.8
  
  # DistilGPT2模型 - 轻量级备用模型
  distilgpt2:
    model_path: "distilgpt2"
    device: auto
    quantization: null
    max_length: 512
    temperature: 0.8
  
  # T5摘要模型 - 用于文本摘要
  t5_summarizer:
    model_path: "t5-small"
    device: auto
    quantization: null
    max_length: 512
    temperature: 0.5
  
  # BART摘要模型 - 备用摘要模型
  bart_summarizer:
    model_path: "facebook/bart-large-cnn"
    device: auto
    quantization: null
    max_length: 1024
    temperature: 0.5
  
  # MiniLM嵌入模型 - 用于向量化
  minilm_embedding:
    model_path: "sentence-transformers/all-MiniLM-L6-v2"
    device: auto
    quantization: null
    # 嵌入维度（由模型决定，此处仅供参考）
    embedding_dim: 384

# -----------------------------------------------------------------------------
# 存储配置 / Storage Configuration
# -----------------------------------------------------------------------------
storage:
  # 向量数据库存储路径
  vector_db_path: "data/vector_db"
  
  # 对话历史存储路径
  chat_history_path: "data/chat_history"
  
  # 意识状态存储路径
  consciousness_state_path: ".consciousness/state.json"
  
  # 执行追踪日志路径
  traces_path: "data/traces"
  
  # 日志文件路径（可选，不设置则只输出到控制台）
  log_file_path: null  # 例如: "logs/muai.log"

# -----------------------------------------------------------------------------
# Router路由器配置 / Router Configuration
# -----------------------------------------------------------------------------
router:
  # 置信度阈值 / Confidence Threshold
  # 当路由决策置信度低于此值时，返回多个候选工作流供用户选择
  # 范围: 0.0-1.0，推荐: 0.5-0.7
  confidence_threshold: 0.6
  
  # 启用路由日志 / Enable Routing Logs
  # 记录每次路由决策的详细信息，用于调试和优化
  enable_logging: true
  
  # 默认工作流 / Default Workflow
  # 当路由失败时使用的默认工作流
  # 可选值: search_qa, lesson_pack, chat_generate, rag_qa, self_ask_search_qa
  default_workflow: "chat_generate"
  
  # 关键词规则配置 / Keyword Rules
  # 用于基于规则的意图分类
  keyword_rules:
    search_qa:
      - "搜索"
      - "查找"
      - "最新"
      - "search"
      - "find"
    lesson_pack:
      - "教学"
      - "课程"
      - "讲解"
      - "teach"
      - "lesson"
    rag_qa:
      - "知识库"
      - "文档"
      - "资料"
      - "knowledge"
      - "document"

# -----------------------------------------------------------------------------
# API接口配置 / API Configuration
# -----------------------------------------------------------------------------
api:
  # 监听地址 / Host
  # 0.0.0.0 表示监听所有网络接口
  # 127.0.0.1 表示只监听本地
  host: "0.0.0.0"
  
  # 监听端口 / Port
  port: 8000
  
  # 启用认证 / Enable Authentication
  # 生产环境强烈建议启用
  enable_auth: false
  
  # API密钥 / API Key
  # 当enable_auth为true时必须设置
  # 建议使用环境变量: ${MUAI_API_KEY}
  api_key: null
  
  # CORS配置 / CORS Configuration
  cors:
    # 允许的来源 / Allowed Origins
    # "*" 表示允许所有来源（不推荐生产环境）
    allowed_origins:
      - "*"
    # 允许的方法 / Allowed Methods
    allowed_methods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
    # 允许的请求头 / Allowed Headers
    allowed_headers:
      - "*"
  
  # 请求限制 / Request Limits
  limits:
    # 最大请求体大小（字节）
    max_request_size: 10485760  # 10MB
    # 请求超时时间（秒）
    request_timeout: 300  # 5分钟

# -----------------------------------------------------------------------------
# 意识模块配置 / Consciousness Module Configuration
# -----------------------------------------------------------------------------
consciousness:
  # 启用意识模块 / Enable Consciousness Modules
  enabled: true
  
  # 自动保存间隔（秒）/ Auto-save Interval
  # 定期保存意识状态到磁盘
  auto_save_interval: 300  # 5分钟
  
  # 情感系统配置 / Emotion System Configuration
  emotion:
    # 效价范围 / Valence Range
    # 负值表示消极情感，正值表示积极情感
    valence_range: [-1.0, 1.0]
    # 唤醒度范围 / Arousal Range
    # 0表示平静，1表示兴奋
    arousal_range: [0.0, 1.0]
    # 情感衰减率 / Decay Rate
    # 情感状态随时间衰减的速率
    decay_rate: 0.1
  
  # 动机系统配置 / Motivation System Configuration
  motivation:
    # 最大目标数量 / Maximum Goals
    max_goals: 10
    # 优先级衰减率 / Priority Decay Rate
    priority_decay: 0.05
  
  # 元认知配置 / Metacognition Configuration
  metacognition:
    # 策略评估阈值 / Strategy Evaluation Threshold
    evaluation_threshold: 0.7
    # 启用自我反思 / Enable Self-Reflection
    enable_reflection: true
  
  # 发展系统配置 / Development System Configuration
  development:
    # 阶段晋升条件 / Stage Promotion Conditions
    promotion_conditions:
      infant_to_child:
        min_interactions: 100
        min_success_rate: 0.7
      child_to_adolescent:
        min_interactions: 500
        min_success_rate: 0.75
      adolescent_to_adult:
        min_interactions: 1000
        min_success_rate: 0.8

# -----------------------------------------------------------------------------
# 工作流配置 / Workflow Configuration
# -----------------------------------------------------------------------------
workflows:
  # SearchQA工作流配置
  search_qa:
    # 最大搜索结果数
    max_search_results: 5
    # 最大抓取URL数
    max_fetch_urls: 3
    # 搜索超时时间（秒）
    search_timeout: 30
    # 抓取超时时间（秒）
    fetch_timeout: 15
  
  # LessonPack工作流配置
  lesson_pack:
    # 最大练习题数量
    max_exercises: 5
    # 讲解内容最大长度
    max_explanation_length: 2000
  
  # ChatGenerate工作流配置
  chat_generate:
    # 历史对话窗口大小
    history_window_size: 10
    # 最大历史长度（tokens）
    max_history_tokens: 2048
  
  # RAGQA工作流配置
  rag_qa:
    # 检索文档数量
    top_k: 5
    # 相似度阈值
    similarity_threshold: 0.5
    # 文档分块大小
    chunk_size: 500
    # 分块重叠大小
    chunk_overlap: 50
  
  # SelfAskSearchQA工作流配置
  self_ask_search_qa:
    # 最大子问题数量
    max_sub_questions: 5
    # 子问题搜索超时（秒）
    sub_question_timeout: 60

# -----------------------------------------------------------------------------
# 性能监控配置 / Performance Monitoring Configuration
# -----------------------------------------------------------------------------
monitoring:
  # 启用性能监控 / Enable Performance Monitoring
  enabled: true
  
  # 指标收集间隔（秒）/ Metrics Collection Interval
  collection_interval: 60
  
  # 保留历史指标数量 / Retained Metrics Count
  max_metrics_history: 1000
  
  # 启用内存监控 / Enable Memory Monitoring
  enable_memory_monitoring: true
  
  # 内存警告阈值（百分比）/ Memory Warning Threshold
  memory_warning_threshold: 80

# -----------------------------------------------------------------------------
# 错误处理配置 / Error Handling Configuration
# -----------------------------------------------------------------------------
error_handling:
  # 最大重试次数 / Maximum Retry Attempts
  max_retries: 3
  
  # 重试退避因子 / Retry Backoff Factor
  # 每次重试等待时间 = backoff_factor ^ attempt
  backoff_factor: 2.0
  
  # 启用降级策略 / Enable Fallback Strategies
  enable_fallback: true
  
  # 模型降级顺序 / Model Fallback Order
  model_fallback_order:
    - "qwen_chat"
    - "gpt2"
    - "distilgpt2"

# =============================================================================
# 环境变量覆盖 / Environment Variable Overrides
# =============================================================================
# 以下配置项可以通过环境变量覆盖：
#
# MUAI_LOG_LEVEL          - 覆盖 system.log_level
# MUAI_DEVICE             - 覆盖 system.device
# MUAI_API_HOST           - 覆盖 api.host
# MUAI_API_PORT           - 覆盖 api.port
# MUAI_API_KEY            - 覆盖 api.api_key
# MUAI_ENABLE_AUTH        - 覆盖 api.enable_auth
# MUAI_DEVELOPMENT_STAGE  - 覆盖 system.development_stage
#
# =============================================================================
